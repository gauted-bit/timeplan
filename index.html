<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ukeplan ‚Äì Lunner ungdomsskole</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fraunces:wght@600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f4f1ec;
  --card: #ffffff;
  --text: #1a1a1a;
  --muted: #7a7168;
  --border: #e2ddd5;
  --border-lt: #eeebe5;
  --accent: #2563eb;
  --accent-light: #dbeafe;
  --green: #059669;
  --green-light: #d1fae5;
  --orange: #ea580c;
  --orange-light: #ffedd5;
  --purple: #7c3aed;
  --purple-light: #ede9fe;
  --rose: #e11d48;
  --rose-light: #ffe4e6;
  --warn: #d97706;
  --warn-bg: #fffbeb;
  --warn-border: #fde68a;
  --radius: 12px;
  --radius-sm: 8px;
  --shadow: 0 1px 3px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.06);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'DM Sans',sans-serif; background:var(--bg); color:var(--text); line-height:1.55; }

/* ‚ïê‚ïê‚ïê TOPBAR ‚ïê‚ïê‚ïê */
.topbar { background:linear-gradient(135deg,#1e293b,#334155); color:white; position:sticky; top:0; z-index:100; box-shadow:0 2px 12px rgba(0,0,0,0.15); }
.topbar-inner { max-width:1000px; margin:0 auto; padding:0.9rem 1.5rem; display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap; }
.topbar-title { font-family:'Fraunces',serif; font-size:1.15rem; font-weight:700; }
.topbar-sub { font-size:0.8rem; opacity:0.6; }
.mode-toggle { display:flex; background:rgba(255,255,255,0.12); border-radius:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.15); }
.mode-btn { padding:0.5rem 1.1rem; border:none; background:transparent; color:rgba(255,255,255,0.65); font-family:'DM Sans',sans-serif; font-size:0.85rem; font-weight:600; cursor:pointer; transition:all 0.2s; white-space:nowrap; }
.mode-btn.active { background:rgba(255,255,255,0.2); color:white; }

.main { max-width:1000px; margin:0 auto; padding:1.5rem; }

/* ‚ïê‚ïê‚ïê TEACHER ‚ïê‚ïê‚ïê */
.teacher-header { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:0.75rem; margin-bottom:1.25rem; }
.teacher-header h2 { font-family:'Fraunces',serif; font-size:1.3rem; font-weight:700; }
.week-row { display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap; }
.week-row label { font-size:0.85rem; font-weight:600; color:var(--muted); }
.week-row input,.week-row select { padding:0.4rem 0.6rem; border:1px solid var(--border); border-radius:6px; font-family:'DM Sans',sans-serif; font-size:0.85rem; background:var(--card); }
.week-row input[type=number] { width:70px; }

.info-section { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1rem; margin-bottom:1rem; }
.info-section h3 { font-size:0.85rem; font-weight:700; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.4rem; }

/* Auto-expanding textarea */
.auto-textarea {
  width:100%; min-height:60px; padding:0.6rem 0.75rem;
  border:1px solid var(--border); border-radius:6px;
  font-family:'DM Sans',sans-serif; font-size:0.88rem; line-height:1.5;
  resize:none; overflow:hidden;
  background:#fafaf8; field-sizing:content;
}
.auto-textarea:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(37,99,235,0.1); }

/* Calendar */
.cal-grid { display:grid; grid-template-columns:60px repeat(5,1fr); gap:0.35rem; margin-top:0.5rem; }
.cal-grid .cal-header { font-size:0.72rem; font-weight:700; text-transform:uppercase; color:var(--muted); padding:0.25rem; text-align:center; }
.cal-grid input { width:100%; padding:0.3rem 0.4rem; border:1px solid var(--border-lt); border-radius:4px; font-family:'DM Sans',sans-serif; font-size:0.8rem; text-align:center; }
.cal-grid input:focus { outline:none; border-color:var(--accent); }
.cal-wk { display:flex; align-items:center; justify-content:center; font-weight:700; font-size:0.82rem; color:var(--muted); }

/* ‚ïê‚ïê‚ïê SUBJECT CARDS (teacher) ‚ïê‚ïê‚ïê */
.scard { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); margin-bottom:0.75rem; overflow:hidden; transition:box-shadow 0.2s; }
.scard:hover { box-shadow:var(--shadow-md); }
.scard-head { display:flex; align-items:center; justify-content:space-between; padding:0.75rem 1rem; cursor:pointer; user-select:none; transition:background 0.15s; }
.scard-head:hover { background:#faf9f7; }
.scard-left { display:flex; align-items:center; gap:0.6rem; }
.scard-chev { color:var(--muted); transition:transform 0.25s; font-size:0.85rem; }
.scard.open .scard-chev { transform:rotate(180deg); }
.scard-body { display:none; padding:0 1rem 1rem; border-top:1px solid var(--border-lt); }
.scard.open .scard-body { display:block; }

/* Group columns */
.groups-area { margin-top:0.5rem; }
.groups-grid { display:flex; flex-wrap:wrap; gap:0.75rem; }
.group-col {
  flex:1; min-width:220px; background:#fafaf8;
  border:1px solid var(--border-lt); border-radius:var(--radius-sm);
  padding:0.75rem; position:relative;
}

.gc-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem; gap:0.4rem; }
.gc-name-input {
  font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:700;
  padding:0.25rem 0.5rem; border:1px solid transparent; border-radius:4px;
  background:transparent; flex:1; min-width:0;
  text-transform:uppercase; letter-spacing:0.03em;
}
.gc-name-input:hover { border-color:var(--border); }
.gc-name-input:focus { outline:none; border-color:var(--accent); background:white; }

.gc-delete {
  width:24px; height:24px; border:none; background:transparent;
  color:var(--muted); font-size:1rem; cursor:pointer; border-radius:4px;
  display:flex; align-items:center; justify-content:center;
  transition:all 0.15s; flex-shrink:0;
}
.gc-delete:hover { background:#fee2e2; color:#dc2626; }

.gc-color-stripe {
  position:absolute; top:0; left:0; right:0; height:3px; border-radius:8px 8px 0 0;
}

.sfield { margin-bottom:0.5rem; }
.slabel { display:block; font-size:0.73rem; font-weight:600; color:var(--muted); margin-bottom:0.15rem; }
.sinput {
  width:100%; padding:0.4rem 0.55rem; border:1px solid var(--border);
  border-radius:6px; font-family:'DM Sans',sans-serif; font-size:0.84rem; background:white;
}
.sinput:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(37,99,235,0.08); }
textarea.sinput { min-height:50px; resize:none; overflow:hidden; line-height:1.45; field-sizing:content; }

.add-group-btn {
  display:flex; align-items:center; justify-content:center; gap:0.35rem;
  min-width:120px; min-height:80px;
  border:2px dashed var(--border); border-radius:var(--radius-sm);
  background:transparent; font-family:'DM Sans',sans-serif;
  font-size:0.82rem; font-weight:600; color:var(--muted);
  cursor:pointer; transition:all 0.2s; padding:0.75rem;
  align-self:stretch;
}
.add-group-btn:hover { border-color:var(--accent); color:var(--accent); background:#f8faff; }

/* Shared fields row */
.shared-row { margin-top:0.65rem; padding-top:0.6rem; border-top:1px solid var(--border-lt); }

/* Action bar */
.action-bar { display:flex; gap:0.75rem; flex-wrap:wrap; margin-top:1.25rem; padding-top:1rem; border-top:1px solid var(--border); }
.btn { padding:0.6rem 1.3rem; border:none; border-radius:var(--radius-sm); font-family:'DM Sans',sans-serif; font-size:0.88rem; font-weight:600; cursor:pointer; transition:all 0.2s; }
.btn-primary { background:var(--accent); color:white; }
.btn-primary:hover { background:#1d4ed8; }
.btn-secondary { background:var(--card); color:var(--text); border:1px solid var(--border); }
.btn-secondary:hover { background:#f5f3ef; }
.btn-green { background:var(--green); color:white; }
.btn-green:hover { background:#047857; }

/* Tags */
.stag {
  font-size:0.7rem; font-weight:700; text-transform:uppercase; letter-spacing:0.05em;
  padding:0.2rem 0.55rem; border-radius:4px; white-space:nowrap;
}

/* ‚ïê‚ïê‚ïê PRINT STYLES ‚ïê‚ïê‚ïê */
@media print {
  .topbar, .group-picker, .print-btn, .toast { display:none !important; }
  .main { padding:0.5rem; max-width:100%; }
  
  /* Print header visible on all pages */
  .print-header {
    display: block !important;
    padding: 0.5rem 1rem;
    background: white;
    border-bottom: 2px solid #2563eb;
    font-family: 'Fraunces', serif;
    font-size: 0.9rem;
    font-weight: 700;
    color: #1a1a1a;
    text-align: center;
    margin-bottom: 0.5rem;
  }
  
  /* Second print header on page 2 */
  .print-header-page2 {
    page-break-before: always;
    margin-top: 0;
    padding-top: 0;
  }
  
  /* Hide screen header elements on print */
  .p-header h2, .p-header .ph-sub, .p-header > div[style*="font-size"] { display: none !important; }
  
  /* Calendar at top of page 1 */
  .p-calendar { 
    margin-bottom: 0.6rem;
    order: -1; /* Move calendar to top */
  }
  .p-cal-table { 
    font-size: 0.75rem;
    border-collapse: separate;
    border-spacing: 0;
  }
  .p-cal-table th, .p-cal-table td { 
    padding: 0.3rem 0.4rem;
    border: 1px solid #cbd5e1;
  }
  .p-cal-table th {
    background: #f1f5f9;
    font-weight: 700;
  }
  .p-cal-table td:first-child {
    background: #f8fafc;
    font-weight: 700;
  }
  
  /* Alerts at bottom of page 1 */
  .p-alerts { 
    margin-bottom: 0.5rem;
    order: 10; /* Move alerts to bottom */
  }
  .p-alert { padding: 0.4rem 0.6rem; font-size: 0.75rem; margin-bottom: 0.25rem; }
  
  /* Equipment list - vertical layout */
  .equip-strip { 
    margin-bottom: 0.6rem;
    padding: 0.6rem;
    order: 5;
  }
  .equip-strip h3 { font-size: 0.85rem; margin-bottom: 0.4rem; }
  .equip-list {
    display: flex;
    flex-direction: column !important;
    gap: 0.25rem !important;
  }
  .equip-chip { 
    font-size: 0.75rem;
    padding: 0.3rem 0.5rem;
    display: block !important;
    width: 100%;
  }
  
  /* Page 1 structure - show header */
  .p-header { 
    display: block !important;
    margin-bottom: 0.5rem;
  }
  .p-header h2, .p-header .ph-sub { display: none !important; }
  .p-header > div[style*="font-size"] { display: none !important; }
  
  /* Calendar - fixed column widths */
  .p-calendar {
    margin-bottom: 0.5rem;
  }
  .p-cal-table {
    font-size: 0.68rem;
    border-collapse: separate;
    border-spacing: 0;
    width: 100%;
    table-layout: fixed;
  }
  .p-cal-table th, .p-cal-table td {
    padding: 0.25rem 0.3rem;
    border: 1px solid #cbd5e1;
  }
  .p-cal-table th:first-child,
  .p-cal-table td:first-child {
    width: 45px;
  }
  .p-cal-table th {
    background: #f1f5f9;
    font-weight: 700;
  }
  .p-cal-table td:first-child {
    background: #f8fafc;
    font-weight: 700;
  }
  
  /* Equipment list - vertical layout */
  .equip-strip {
    margin-bottom: 0.5rem;
    padding: 0.5rem;
  }
  .equip-strip h3 { font-size: 0.78rem; margin-bottom: 0.3rem; }
  .equip-list {
    display: flex;
    flex-direction: column !important;
    gap: 0.2rem !important;
  }
  .equip-chip {
    font-size: 0.68rem;
    padding: 0.25rem 0.4rem;
  }
  
  /* Alerts after equipment */
  .p-alerts {
    margin-bottom: 0.5rem;
  }
  .p-alert { padding: 0.35rem 0.5rem; font-size: 0.7rem; margin-bottom: 0.2rem; }

  /* Class name colors in header */
  .print-header .class-8a { color: #dc2626; font-weight: 800; }
  .print-header .class-8b { color: #2563eb; font-weight: 800; }
  
  /* Page 2: Stronger separators between days */
  .day-block {
    margin-bottom: 0.5rem;
    page-break-inside: avoid;
    border: 2px solid #1e293b;
    border-radius: 8px;
    padding: 0.4rem;
    background: white;
  }
  
  /* Alternating soft background colors for days */
  /* Note: print-header-page2 is first child, so day blocks start at nth-child(2) */
  .day-block:nth-child(2) { 
    background: #fef3c7 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  } /* Mandag - soft yellow */
  .day-block:nth-child(3) { 
    background: #dbeafe !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  } /* Tirsdag - soft blue */
  .day-block:nth-child(4) { 
    background: #dcfce7 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  } /* Onsdag - soft green */
  .day-block:nth-child(5) { 
    background: #fce7f3 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  } /* Torsdag - soft pink */
  .day-block:nth-child(6) { 
    background: #e0e7ff !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  } /* Fredag - soft purple */
  
  .day-strip {
    margin-bottom: 0.4rem;
    padding-bottom: 0.3rem;
    border-bottom: 3px solid #1e293b;
    background: rgba(255,255,255,0.7);
    padding: 0.25rem 0.4rem;
    border-radius: 4px;
    margin: -0.3rem -0.3rem 0.4rem -0.3rem;
  }
  .day-lbl {
    font-size: 1rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }
  .day-dt {
    font-size: 0.68rem;
    opacity: 0.8;
  }
  
  /* Align homework cards with flexbox */
  .hw-card {
    margin-bottom: 0.3rem;
    padding: 0.4rem 0.5rem;
    display: flex;
    gap: 0.6rem;
    align-items: flex-start;
    border: 1.5px solid #94a3b8;
    border-radius: 4px;
    background: white;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }

  /* Checkbox for students */
  .hw-checkbox {
    width: 16px;
    height: 16px;
    border: 2px solid #475569;
    border-radius: 3px;
    flex-shrink: 0;
    margin-top: 2px;
    background: white;
  }
  .hw-tag {
    font-size: 0.64rem;
    padding: 0.18rem 0.4rem;
    min-width: 85px;
    max-width: 85px;
    text-align: center;
    flex-shrink: 0;
    font-weight: 700;
  }
  .hw-body { flex: 1; }
  .hw-body-text {
    font-size: 0.72rem;
    line-height: 1.35;
    font-weight: 500;
  }
  .hw-empty { font-size: 0.68rem; padding: 0.35rem; }
}
.t-matte{background:#fef3c7;color:#92400e}.t-norsk{background:#fee2e2;color:#991b1b}
.t-engelsk{background:#dbeafe;color:#1e40af}.t-samf{background:#e0e7ff;color:#3730a3}
.t-krle{background:#fae8ff;color:#86198f}.t-naturfag{background:#d1fae5;color:#065f46}
.t-kh{background:#ffedd5;color:#9a3412}.t-musikk{background:#fce7f3;color:#9d174d}
.t-sprak{background:#e0f2fe;color:#075985}.t-gym{background:#f5f3ff;color:#5b21b6}
.t-svomming{background:#cffafe;color:#155e75}.t-alf{background:#dcfce7;color:#166534}
.t-valgfag{background:#f5f5f4;color:#57534e}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PARENT VIEW
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.p-header { text-align:center; margin-bottom:1.25rem; }
.p-header h2 { font-family:'Fraunces',serif; font-size:1.6rem; font-weight:800; letter-spacing:-0.02em; }
.p-header .ph-sub { color:var(--muted); font-size:0.9rem; margin-top:0.15rem; }

.group-picker { display:flex; justify-content:center; margin-bottom:1.25rem; }
.gp-wrap { display:flex; flex-wrap:wrap; gap:0.35rem; background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:0.3rem; box-shadow:var(--shadow-md); }
.gp-btn {
  padding:0.55rem 1.2rem; border:none; background:transparent;
  font-family:'DM Sans',sans-serif; font-size:0.88rem; font-weight:600;
  cursor:pointer; color:var(--muted); border-radius:8px; transition:all 0.2s;
}
.gp-btn.sel { background:var(--accent); color:white; }

.p-alerts { display:flex; flex-direction:column; gap:0.4rem; margin-bottom:1rem; }
.p-alert { display:flex; align-items:flex-start; gap:0.5rem; padding:0.65rem 0.9rem; border-radius:var(--radius-sm); border:1px solid var(--warn-border); background:var(--warn-bg); font-size:0.87rem; }

.p-calendar { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); overflow-x:auto; margin-bottom:1rem; }
.p-cal-table { width:100%; border-collapse:collapse; font-size:0.82rem; min-width:500px; }
.p-cal-table th { padding:0.5rem 0.6rem; background:#faf9f7; font-weight:700; text-align:center; border-bottom:2px solid var(--border); font-size:0.78rem; text-transform:uppercase; color:var(--muted); }
.p-cal-table th:first-child { width:55px; }
.p-cal-table td { padding:0.4rem 0.5rem; text-align:center; border-bottom:1px solid var(--border-lt); }
.p-cal-table td:first-child { font-weight:700; color:var(--muted); }
.p-cal-table td.has-ev { font-weight:600; color:var(--accent); }

.day-block { margin-bottom:0.9rem; }
.day-strip { display:flex; align-items:center; gap:0.65rem; margin-bottom:0.4rem; }
.day-dot { width:8px; height:8px; border-radius:50%; background:var(--accent); flex-shrink:0; }
.day-lbl { font-family:'Fraunces',serif; font-weight:600; font-size:1.05rem; }
.day-dt { font-size:0.82rem; color:var(--muted); }
.day-rule { flex:1; height:1px; background:var(--border); }
.hw-cards { display:flex; flex-direction:column; gap:0.4rem; }
.hw-card { display:flex; gap:0.75rem; align-items:flex-start; padding:0.7rem 0.85rem; background:var(--card); border:1px solid var(--border); border-radius:var(--radius-sm); }
.hw-tag { font-size:0.68rem; font-weight:700; text-transform:uppercase; letter-spacing:0.04em; padding:0.15rem 0.45rem; border-radius:4px; white-space:nowrap; flex-shrink:0; margin-top:2px; }
.hw-body { flex:1; }
.hw-body-text { font-size:0.88rem; }
.hw-body-meta { font-size:0.76rem; color:var(--muted); margin-top:0.15rem; }
.hw-empty { padding:0.9rem; text-align:center; color:var(--muted); font-size:0.88rem; background:var(--card); border:1px dashed var(--border); border-radius:var(--radius-sm); }

.equip-strip { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:0.75rem 1rem; margin-bottom:1rem; }
.equip-strip h3 { font-size:0.78rem; font-weight:700; text-transform:uppercase; color:var(--muted); margin-bottom:0.35rem; }
.equip-list { display:flex; flex-wrap:wrap; gap:0.35rem; }
.equip-chip { display:inline-flex; align-items:center; gap:0.3rem; font-size:0.8rem; padding:0.2rem 0.6rem; background:#f1f0ec; border-radius:4px; font-weight:500; }

/* Toast */
.toast { position:fixed; bottom:1.5rem; left:50%; transform:translateX(-50%) translateY(100px); background:#1e293b; color:white; padding:0.75rem 1.5rem; border-radius:var(--radius); font-weight:600; font-size:0.88rem; box-shadow:var(--shadow-md); transition:transform 0.3s ease; z-index:200; }
.toast.show { transform:translateX(-50%) translateY(0); }

/* Timetable styles - only show on print */
.timetable-section {
  display: none !important;
}

/* Print */
@media print {
  body{background:white}
  .topbar{position:static;background:#1e293b!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .mode-toggle{display:none}
  .hw-tag,.stag,.p-alert,.equip-chip,.gp-btn.sel{-webkit-print-color-adjust:exact;print-color-adjust:exact}

  /* Show timetable in print */
  .timetable-section {
    display: block !important;
    margin-bottom: 0.6rem;
    page-break-inside: avoid;
    visibility: visible !important;
    opacity: 1 !important;
  }
  .timetable-section h3 {
    font-size: 0.85rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
    text-align: center;
    color: #1a1a1a;
  }
  .timetable {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 0.4rem;
    visibility: visible !important;
  }
  .timetable th {
    background: #1e40af !important;
    color: white !important;
    font-weight: 700;
    padding: 0.3rem 0.25rem;
    border: 1px solid #1e3a8a;
    text-align: center;
    font-size: 0.68rem;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable td {
    padding: 0.4rem 0.25rem;
    border: 1px solid #cbd5e1 !important;
    text-align: center;
    vertical-align: top;
    font-size: 0.65rem;
    height: 52px;
  }
  .timetable .time {
    display: block !important;
    font-size: 0.55rem;
    font-weight: 600;
    margin-bottom: 0.15rem;
    color: #1e293b !important;
  }
  .timetable .subject {
    display: block !important;
    font-weight: 700;
    font-size: 0.66rem;
    color: #1a1a1a !important;
  }
  .timetable .break-cell {
    background: white !important;
    font-weight: 700;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .norsk-cell {
    background: #fee2e2 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .samfunnsfag-cell {
    background: #e0e7ff !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .naturfag-cell {
    background: #d1fae5 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .matte-cell {
    background: #fef08a !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .engelsk-cell {
    background: #dbeafe !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .kh-cell {
    background: #ffedd5 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .sprak-cell {
    background: #7dd3fc !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .krle-cell {
    background: #fae8ff !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .gym-cell {
    background: #f5f3ff !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .svomming-cell {
    background: #cffafe !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .musikk-cell {
    background: #fce7f3 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .valgfag-cell {
    background: #f5f5f4 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }
  .timetable .klassens-cell {
    background: #ede9fe !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }

  /* Tema/M√•l section */
  .tema-section {
    margin-bottom: 0.5rem;
    page-break-inside: avoid;
    border: 2px solid #1e293b;
    border-radius: 8px;
    padding: 0.4rem;
    background: white;
  }
  .tema-section h3 {
    font-size: 0.88rem;
    font-weight: 700;
    margin-bottom: 0.33rem;
    text-align: center;
    color: #1a1a1a;
  }
  .tema-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.68rem;
  }
  .tema-table tr {
    border-bottom: 1px solid #e2ddd5;
  }
  .tema-table tr:last-child {
    border-bottom: none;
  }
  .tema-subject {
    font-weight: 700;
    padding: 0.3rem 0.6rem;
    width: 170px;
    min-width: 170px;
    max-width: 170px;
    text-align: center;
    font-size: 0.59rem;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }
  .tema-text {
    padding: 0.28rem 0.44rem;
    line-height: 1.35;
  }
}
@media(max-width:700px){
  .main{padding:1rem}
  .groups-grid{flex-direction:column}
  .topbar-inner{flex-direction:column;align-items:flex-start}
}

@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.fade-in{animation:fadeIn 0.25s ease both}

/* Print header - hidden on screen, visible on print */
.print-header { display: none; }
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-inner">
    <div>
      <div class="topbar-title" id="topbar-title">Ukeplan ‚Äì Uke 7</div>
      <div class="topbar-sub">Lunner ungdomsskole ¬∑ 8. trinn</div>
    </div>
    <div class="mode-toggle">
      <button class="mode-btn active" onclick="setMode('teacher')">‚úèÔ∏è L√¶rer</button>
      <button class="mode-btn" onclick="setMode('parent')">üëÅÔ∏è Elev / Foresatt</button>
    </div>
  </div>
</div>

<div class="main">
  <div id="teacher-view">
    <div class="teacher-header">
      <h2>Rediger ukeplan</h2>
      <div class="week-row">
        <label>Uke</label>
        <input type="number" id="weekNum" value="7" min="1" max="52" onchange="updTitle()">
        <label>Fra</label>
        <input type="date" id="weekStart" value="2026-02-09" onchange="updTitle()">
        <label>Til</label>
        <input type="date" id="weekEnd" value="2026-02-13" onchange="updTitle()">
      </div>
    </div>

    <div class="info-section">
      <h3>üì¢ Viktig informasjon</h3>
      <textarea class="auto-textarea" id="infoText">Husk bokbind p√• ALLE b√∏ker! Det er fremdeles noen som mangler.
8A: Pr√∏ve i samfunnsfag onsdag.
Sv√∏mming mandag: Jentene sv√∏mmer f√∏rst (oddetallsuke).
8B: Kropps√∏ving ‚Äì sk√∏yter, ta med utekl√¶r, lue og hansker.</textarea>
    </div>

    <div class="info-section">
      <h3>üìÖ Ukeoversikt fremover</h3>
      <div class="cal-grid">
        <div class="cal-header">Uke</div><div class="cal-header">Man</div><div class="cal-header">Tir</div><div class="cal-header">Ons</div><div class="cal-header">Tor</div><div class="cal-header">Fre</div>
        <div class="cal-wk" id="wk0">7</div><input id="c00"><input id="c01"><input id="c02"><input id="c03"><input id="c04">
        <div class="cal-wk" id="wk1">8</div><input id="c10"><input id="c11"><input id="c12"><input id="c13"><input id="c14">
        <div class="cal-wk" id="wk2">9</div><input id="c20"><input id="c21"><input id="c22"><input id="c23"><input id="c24">
        <div class="cal-wk" id="wk3">10</div><input id="c30"><input id="c31"><input id="c32"><input id="c33"><input id="c34">
      </div>
    </div>

    <div id="subject-forms"></div>

    <div class="action-bar">
      <button class="btn btn-primary" onclick="saveData()">üíæ Lagre utkast</button>
      <button class="btn btn-green" onclick="setMode('parent')">üëÅÔ∏è Forh√•ndsvis</button>
      <button class="btn btn-secondary" onclick="printParent()">üñ®Ô∏è Skriv ut / PDF</button>
    </div>
  </div>

  <div id="parent-view" style="display:none"></div>
</div>

<div class="toast" id="toast">Lagret!</div>

<script>
const DAYS = ['Mandag','Tirsdag','Onsdag','Torsdag','Fredag'];
const GROUP_COLORS = ['#2563eb','#059669','#ea580c','#7c3aed','#e11d48','#0891b2','#ca8a04','#6d28d9'];

// Calendar data structure - stores events by week number
const calendarData = {
  7: ['', '', '8A: Pr√∏ve samf.', '', ''],
  8: ['Vinterferie', 'Vinterferie', 'Vinterferie', 'Vinterferie', 'Vinterferie'],
  9: ['', '', 'Fransk: Muntlig h√∏ring', '', ''],
  10: ['', 'Fransk: Muntlig h√∏ring', '', '', ''],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SUBJECT DATA MODEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Each subject has an array of groups. Default is 8A/8B.
// Matte has 5 groups as example.
const subjects = [
  { id:'matte', name:'Matematikk', tag:'t-matte',
    groups:[
      { name:'Thomas 8', teachers:'Thomas', tema:'Algebra ‚Äì algebraiske uttrykk, addisjon/subtraksjon', hw:'Gj√∏r utdelt arbeidsark.', day:'Onsdag', color:0 },
      { name:'Sandra 8', teachers:'Sandra', tema:'Algebra ‚Äì algebraiske uttrykk, addisjon/subtraksjon', hw:'Gj√∏r utdelt arbeidsark.', day:'Onsdag', color:1 },
      { name:'Veslem√∏y 8', teachers:'Veslem√∏y', tema:'Algebra ‚Äì algebraiske uttrykk, sette inn verdier, lage uttrykk', hw:'Oppgavebok: 3.125 s.121, 3.130 s.123, 3.134 s.125, 3.137 s.126. Velg 1, 2 eller 3 prikker.', day:'Onsdag', color:2 },
      { name:'Amund 8', teachers:'Amund', tema:'Algebra ‚Äì addisjon/subtraksjon, multiplikasjon/divisjon, potenser', hw:'Oppgavebok: 3.120 s.119 (alle prikker), 3.138 s.126 (prikk 1‚Äì2), 3.126 s.122 (prikk 1‚Äì2).', day:'Onsdag', color:3 },
      { name:'Judith 8', teachers:'Judith', tema:'Grunnleggende regning', hw:'Jobb med arkene i permen. Husk BLYANT til alle timer.', day:'Onsdag', color:4 },
    ],
    equip:'Blyant til alle timer'
  },
  { id:'norsk', name:'Norsk', tag:'t-norsk',
    groups:[
      { name:'8A', teachers:'Siva, Tuva, Eivind', tema:'Les og Delta i debatten ‚Äì skrive appeller', hw:'Ingen lekse. Les 15 min hjemme daglig.', day:'', color:0 },
      { name:'8B', teachers:'B√∏rre, Ann Kristin', tema:'Les og Delta i debatten ‚Äì jobbe i boka', hw:'Forbered muntlig fremf√∏ring. Se s. 213‚Äì214 i Fabel 8. Husk √• levere debattinnlegg!', day:'Torsdag', color:1 },
    ],
    equip:'Fabel-bok, bibliotekbok til alle norsktimer'
  },
  { id:'engelsk', name:'Engelsk', tag:'t-engelsk',
    groups:[
      { name:'8A', teachers:'Siva, Tuva', tema:'Growing up ‚Äì ¬´Food for thought¬ª', hw:'Ingen lekse hvis dere jobber godt i timene.', day:'', color:0 },
      { name:'8B', teachers:'Gaute, P√•l', tema:'Growing up ‚Äì argumenterende tekst', hw:'Skriv ferdig argumenterende tekst (oppgave i Teams). Gj√∏r resten hjemme om du ikke rekker alt.', day:'Fredag', color:1 },
    ],
    equip:'Engelskbok p√• onsdag (8A)'
  },
  { id:'samf', name:'Samfunnsfag', tag:'t-samf',
    groups:[
      { name:'8A', teachers:'H√•kon, Siva', tema:'Den industrielle revolusjon', hw:'Til tirsdag: Fagbegreper (utdelt). Til onsdag: √òv til PR√òVE ‚Äì fagbegreper + boka s. 97‚Äì101.', day:'Onsdag', color:0 },
      { name:'8B', teachers:'Gaute, Eivind', tema:'Den industrielle revolusjon ‚Äì fabrikkbyer og arbeidsforhold', hw:'Les ¬´Fabrikkbyer og arbeidsforhold¬ª (SkolenMin). Skriv de fire punktene i skriveboka, IKKE digitalt.', day:'Tirsdag', color:1 },
    ],
    equip:''
  },
  { id:'krle', name:'KRLE', tag:'t-krle',
    groups:[
      { name:'8A', teachers:'H√•kon, Siva', tema:'Repetisjon verdensreligioner: Islam ‚Äì l√¶ringssti', hw:'Bli ferdig med l√¶ringsstien om Islam.', day:'Tirsdag', color:0 },
      { name:'8B', teachers:'Gaute, Eivind', tema:'Verdensreligioner ‚Äì g√• i dybden (Minecraft)', hw:'Jobb minst 20 min i Minecraft med de religi√∏se bygningene dine.', day:'Tirsdag', color:1 },
    ],
    equip:''
  },
  { id:'naturfag', name:'Naturfag', tag:'t-naturfag',
    groups:[
      { name:'8A', teachers:'Sandra, Veslem√∏y, Tuva', tema:'Vitenskap ‚Äì atommodeller', hw:'Tegn atommodeller i kladdeboka: hydrogen, helium, oksygen, nitrogen, natrium.', day:'Fredag', color:0 },
      { name:'8B', teachers:'Sandra, Ann Kristin, Espen', tema:'Vitenskap ‚Äì atommodeller', hw:'Tegn atommodeller i kladdeboka: hydrogen, helium, oksygen, nitrogen, natrium.', day:'Fredag', color:1 },
    ],
    equip:''
  },
  { id:'kh', name:'K&H', tag:'t-kh',
    groups:[
      { name:'Metallsl√∏yd', teachers:'Judith', tema:'Aluminium', hw:'', day:'', color:0 },
      { name:'Tresl√∏yd', teachers:'Espen', tema:'Tre som materiale ‚Äì oppstart skj√¶refj√∏l', hw:'', day:'', color:1 },
    ],
    equip:'Kl√¶r som t√•ler verksted, h√•rstrikk om n√∏dvendig'
  },
  { id:'musikk', name:'Musikk', tag:'t-musikk',
    groups:[
      { name:'8A', teachers:'Siva', tema:'Rytmer, takt, taktslag og samspill', hw:'', day:'', color:0 },
      { name:'8B', teachers:'Thomas', tema:'Rytmer, takt, taktslag og samspill ‚Äì bygger p√• uke 6', hw:'', day:'', color:1 },
    ],
    equip:''
  },
  { id:'sprak', name:'Spr√•klig fordypning', tag:'t-sprak',
    groups:[
      { name:'Spansk', teachers:'Doramas', tema:'Regelrette og uregelrette verb', hw:'', day:'', color:0 },
      { name:'Fransk', teachers:'P√•l', tema:'Kap 4 ‚Äì La famille, eiendomsord, telle til 50, avoir/√™tre', hw:'Gj√∏r ferdig oppgaver om eiendomsord i SkolenMin. Muntlig h√∏ring uke 9‚Äì10.', day:'Tirsdag', color:1 },
    ],
    equip:''
  },
  { id:'gym', name:'Kropps√∏ving', tag:'t-gym',
    groups:[
      { name:'8A', teachers:'H√•kon, Eivind', tema:'Volleyball (inne)', hw:'', day:'', color:0 },
      { name:'8B', teachers:'Ann Kristin, Eivind', tema:'Vinteraktiviteter ‚Äì sk√∏yter', hw:'', day:'', color:1 },
    ],
    equip:'8A: Innet√∏y og innesko. 8B: Utekl√¶r, lue, hansker.'
  },
  { id:'valgfag', name:'Valgfag', tag:'t-valgfag',
    groups:[
      { name:'Alle', teachers:'Diverse', tema:'Fysisk akt.: Vinteraktiviteter (ski). NMF: Sk√∏yter. D&R: Papp-prosjekt. Prog: Python. Prod: We are the World. Innsats: Lek med barnehagebarn. UPT: Fylkesmesse.', hw:'', day:'', color:0 },
    ],
    equip:'Utekl√¶r for utevalgfag'
  },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDER TEACHER FORMS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderForms() {
  const wrap = document.getElementById('subject-forms');
  let html = '';

  subjects.forEach((s, si) => {
    const groupSummary = s.groups.map(g => g.name).join(', ');
    html += `<div class="scard" id="sc-${si}">
      <div class="scard-head" onclick="togSC(${si})">
        <div class="scard-left">
          <span class="stag ${s.tag}">${s.name}</span>
          <span style="font-size:0.82rem;color:var(--muted)">${groupSummary}</span>
        </div>
        <span class="scard-chev">‚ñæ</span>
      </div>
      <div class="scard-body">
        <div class="groups-area">
          <div class="groups-grid" id="gg-${si}">`;

    s.groups.forEach((g, gi) => {
      html += renderGroupCol(si, gi, g);
    });

    html += `<button class="add-group-btn" onclick="addGroup(${si})">+ Legg til gruppe</button>`;
    html += `</div></div>`;

    // Shared equip
    html += `<div class="shared-row">
      <div class="sfield">
        <label class="slabel">üì¶ Utstyr √• ha med (alle grupper)</label>
        <input class="sinput" id="eq-${si}" value="${esc(s.equip || '')}">
      </div>
    </div>`;

    html += '</div></div>';
  });

  wrap.innerHTML = html;
  autoGrowAll();
}

function renderGroupCol(si, gi, g) {
  const color = GROUP_COLORS[g.color % GROUP_COLORS.length];
  return `<div class="group-col" id="gc-${si}-${gi}">
    <div class="gc-color-stripe" style="background:${color}"></div>
    <div class="gc-header">
      <input class="gc-name-input" value="${esc(g.name)}" onchange="updGroup(${si},${gi},'name',this.value)" style="color:${color}">
      <button class="gc-delete" onclick="delGroup(${si},${gi})" title="Slett gruppe">√ó</button>
    </div>
    <div class="sfield">
      <label class="slabel">L√¶rere</label>
      <input class="sinput" value="${esc(g.teachers)}" onchange="updGroup(${si},${gi},'teachers',this.value)">
    </div>
    <div class="sfield">
      <label class="slabel">Tema / m√•l</label>
      <textarea class="sinput" onchange="updGroup(${si},${gi},'tema',this.value)">${esc(g.tema)}</textarea>
    </div>
    <div class="sfield">
      <label class="slabel">Lekse / hjemmearbeid</label>
      <textarea class="sinput" onchange="updGroup(${si},${gi},'hw',this.value)">${esc(g.hw)}</textarea>
    </div>
    <div class="sfield">
      <label class="slabel">Fristdag</label>
      <select class="sinput" style="min-height:auto" onchange="updGroup(${si},${gi},'day',this.value)">
        <option value="">Ingen lekse</option>
        ${DAYS.map(d => `<option value="${d}"${g.day===d?' selected':''}>${d}</option>`).join('')}
      </select>
    </div>
  </div>`;
}

function togSC(i) { document.getElementById('sc-'+i).classList.toggle('open'); }

function updGroup(si, gi, field, val) { subjects[si].groups[gi][field] = val; }

function addGroup(si) {
  const s = subjects[si];
  const ci = s.groups.length;
  s.groups.push({ name:'Ny gruppe', teachers:'', tema:'', hw:'', day:'', color: ci });
  renderForms();
  document.getElementById('sc-'+si).classList.add('open');
}

function delGroup(si, gi) {
  if (subjects[si].groups.length <= 1) return showToast('M√• ha minst √©n gruppe');
  subjects[si].groups.splice(gi, 1);
  renderForms();
  document.getElementById('sc-'+si).classList.add('open');
}

function esc(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// Auto-grow textareas
function autoGrowAll() {
  document.querySelectorAll('.auto-textarea, textarea.sinput').forEach(ta => {
    ta.style.height = 'auto';
    ta.style.height = ta.scrollHeight + 'px';
    ta.addEventListener('input', function() { this.style.height='auto'; this.style.height=this.scrollHeight+'px'; });
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PARENT VIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selGroup = null; // selected group name

function getAllGroupNames() {
  const names = new Set();
  subjects.forEach(s => s.groups.forEach(g => names.add(g.name)));
  // Filter to only show 8A and 8B in parent view
  const filtered = [...names].filter(name => name === '8A' || name === '8B');
  return filtered.sort((a,b) => {
    // Sort: 8A first, then 8B
    if (a === '8A') return -1; if (b === '8A') return 1;
    if (a === '8B') return -1; if (b === '8B') return 1;
    return a.localeCompare(b, 'no');
  });
}

function renderParent() {
  const wk = document.getElementById('weekNum').value;
  const ws = document.getElementById('weekStart').value;
  const we = document.getElementById('weekEnd').value;
  const info = document.getElementById('infoText').value;

  const allGroups = getAllGroupNames();
  if (!selGroup || !allGroups.includes(selGroup)) selGroup = allGroups[0] || '8A';

  const startDate = new Date(ws);
  const dates = [];
  for (let i=0; i<5; i++) { const d=new Date(startDate); d.setDate(d.getDate()+i); dates.push(`${d.getDate()}.${d.getMonth()+1}`); }

  let h = '';

  // Print header (fixed on all pages when printing)
  const classColor = selGroup === '8A' ? 'class-8a' : 'class-8b';
  h += `<div class="print-header">Informasjon uke ${wk} ‚Äì Klasse <span class="${classColor}">${selGroup}</span> ‚Äì Lunner ungdomsskole</div>`;

  // Header
  h += `<div class="p-header fade-in">
    <h2>Ukeplan ‚Äì Uke ${wk}</h2>
    <div class="ph-sub">${fmtRange(ws,we)} ¬∑ Lunner ungdomsskole ¬∑ 8. trinn</div>
    <div style="font-size:1.3rem; font-weight:700; color:var(--accent); margin-top:0.5rem; font-family:'Fraunces',serif;">Klasse: ${selGroup}</div>
    <button class="print-btn" onclick="window.print()" style="margin-top:0.75rem; padding:0.6rem 1.5rem; background:var(--accent); color:white; border:none; border-radius:var(--radius-sm); font-family:'DM Sans',sans-serif; font-size:0.88rem; font-weight:600; cursor:pointer; box-shadow:var(--shadow-md); transition:all 0.2s;">üñ®Ô∏è Skriv ut ukeplan</button>
    </div>`;

  // Group picker
  h += '<div class="group-picker"><div class="gp-wrap">';
  allGroups.forEach(gn => {
    h += `<button class="gp-btn ${gn===selGroup?'sel':''}" onclick="selGroup='${esc(gn)}';renderParent()">${gn}</button>`;
  });
  h += '</div></div>';

  // Calendar
  const cal = [];
  for (let r=0; r<4; r++) { const row=[]; for(let c=0;c<5;c++) { const el=document.getElementById(`c${r}${c}`); row.push(el?el.value:''); } cal.push(row); }
  if (cal.some(r=>r.some(c=>c.trim()))) {
    h += '<div class="p-calendar fade-in"><table class="p-cal-table"><thead><tr><th>Uke</th>';
    DAYS.forEach(d => h += `<th>${d.substring(0,3)}</th>`);
    h += '</tr></thead><tbody>';
    const wkN = parseInt(wk);
    cal.forEach((row,ri) => {
      h += `<tr><td>${wkN+ri}</td>`;
      row.forEach(cell => { h += cell.trim() ? `<td class="has-ev">${cell}</td>` : '<td>‚Äì</td>'; });
      h += '</tr>';
    });
    h += '</tbody></table></div>';
  }

  // Collect homework for selected group
  const hwByDay = {};
  DAYS.forEach(d => hwByDay[d] = []);

  subjects.forEach(s => {
    // Collect equipment
    s.groups.forEach(g => {
      if (g.name === selGroup && g.hw && g.hw.trim() && g.day) {
        hwByDay[g.day].push({ subj: s.name, tag: s.tag, text: g.hw, group: g.name });
      }
    });
  });

  // Timetable for 8B - place BEFORE calendar
  if (selGroup === '8B') {
    h += '<div class="timetable-section">';
    h += '<h3>üìÖ Timeplan 8B</h3>';
    h += '<table class="timetable">';
    h += '<thead><tr><th>MANDAG</th><th>TIRSDAG</th><th>ONSDAG</th><th>TORSDAG</th><th>FREDAG</th></tr></thead>';
    h += '<tbody>';
    // Row 1
    h += '<tr>';
    h += '<td class="norsk-cell" rowspan="2"><span class="time">08.30-10.00</span><span class="subject">Norsk</span></td>';
    h += '<td class="samfunnsfag-cell" rowspan="2"><span class="time">08.30-10.00</span><span class="subject">Samfunnsfag</span></td>';
    h += '<td class="samfunnsfag-cell"><span class="time">08.00-09.00</span><span class="subject">Samfunnsfag</span></td>';
    h += '<td class="norsk-cell"><span class="time">08.30-09.30</span><span class="subject">Norsk</span></td>';
    h += '<td class="klassens-cell"><span class="time">08.30-09.00</span><span class="subject">Klassens time</span></td>';
    h += '</tr>';
    // Row 2
    h += '<tr>';
    h += '<td class="naturfag-cell"><span class="time">09.10-10.10</span><span class="subject">Naturfag</span></td>';
    h += '<td class="norsk-cell"><span class="time">09.40-10.40</span><span class="subject">Norsk</span></td>';
    h += '<td class="naturfag-cell"><span class="time">09.00-10.00</span><span class="subject">Naturfag</span></td>';
    h += '</tr>';
    // Row 3
    h += '<tr>';
    h += '<td class="matte-cell"><span class="time">10.10-11.10</span><span class="subject">Matte</span></td>';
    h += '<td class="matte-cell"><span class="time">10.10-11.10</span><span class="subject">Matte</span></td>';
    h += '<td class="matte-cell"><span class="time">10.20-11.20</span><span class="subject">Matte</span></td>';
    h += '<td class="break-cell"><span class="time">10.40-11.20</span><span class="subject">STOREFRI</span></td>';
    h += '<td class="gym-cell"><span class="time">10.10-11.10</span><span class="subject">Kropps√∏ving</span></td>';
    h += '</tr>';
    // Row 4
    h += '<tr>';
    h += '<td class="break-cell"><span class="time">11.10-11.50</span><span class="subject">STOREFRI</span></td>';
    h += '<td class="break-cell"><span class="time">11.10-11.50</span><span class="subject">STOREFRI</span></td>';
    h += '<td class="break-cell"><span class="time">11.20-11.50</span><span class="subject">STOREFRI</span></td>';
    h += '<td class="engelsk-cell"><span class="time">11.20-12.20</span><span class="subject">Engelsk</span></td>';
    h += '<td class="break-cell"><span class="time">11.10-11.50</span><span class="subject">STOREFRI</span></td>';
    h += '</tr>';
    // Row 5
    h += '<tr>';
    h += '<td class="kh-cell"><span class="time">11.50-12.50</span><span class="subject">Kunst og h√•ndverk</span></td>';
    h += '<td class="sprak-cell"><span class="time">11.50-12.50</span><span class="subject">Spr√•k/Alf</span></td>';
    h += '<td class="sprak-cell"><span class="time">11.50-12.50</span><span class="subject">Spr√•k/Alf</span></td>';
    h += '<td class="valgfag-cell" rowspan="2"><span class="time">12.30-14.00</span><span class="subject">Valgfag</span></td>';
    h += '<td class="svomming-cell"><span class="time">11.50-12.50</span><span class="subject">Sv√∏mming/Musikk</span></td>';
    h += '</tr>';
    // Row 6
    h += '<tr>';
    h += '<td class="kh-cell"><span class="time">13.00-14.00</span><span class="subject">Kunst og h√•ndverk</span></td>';
    h += '<td class="krle-cell"><span class="time">13.00-14.00</span><span class="subject">KRLE</span></td>';
    h += '<td class="engelsk-cell"><span class="time">13.00-14.00</span><span class="subject">Engelsk</span></td>';
    h += '<td class="svomming-cell"><span class="time">13.00-14.00</span><span class="subject">Sv√∏mming/Musikk</span></td>';
    h += '</tr>';
    h += '</tbody></table>';
    h += '</div>';
  }

  // Equipment
  const eqItems = [];
  subjects.forEach(s => {
    const eq = document.getElementById('eq-' + subjects.indexOf(s));
    const eqVal = eq ? eq.value : s.equip;
    if (eqVal && eqVal.trim()) eqItems.push({ name: s.name, tag: s.tag, text: eqVal });
  });
  if (eqItems.length) {
    h += '<div class="equip-strip fade-in"><h3>üéí Utstyr √• ha med</h3><div class="equip-list">';
    eqItems.forEach(e => { h += `<span class="equip-chip"><span class="hw-tag ${e.tag}" style="margin:0">${e.name}</span> ${e.text}</span>`; });
    h += '</div></div>';
  }

  // Alerts (after equipment)
  if (info.trim()) {
    h += '<div class="p-alerts fade-in">';
    info.split('\n').filter(l=>l.trim()).forEach(line => {
      // Show if line mentions selected group or is general
      const lower = line.toLowerCase();
      const mentions = allGroups.filter(g => lower.includes(g.toLowerCase() + ':') || lower.includes(g.toLowerCase() + ' :'));
      if (mentions.length > 0 && !mentions.includes(selGroup)) return;
      h += `<div class="p-alert"><span>üìå</span><span>${line}</span></div>`;
    });
    h += '</div>';
  }

  // Tema/M√•l table before homework
  const temaData = [];
  subjects.forEach(s => {
    // For each subject, check if any group matches the selected class
    const matchingGroups = s.groups.filter(g => {
      // Match exact group name (8A, 8B) or groups containing "8" (for math groups like "Thomas 8")
      return g.name === selGroup || (g.name.includes('8') && s.id === 'matte');
    });

    // If we have matching groups with tema, add them
    if (matchingGroups.length > 0) {
      if (s.id === 'matte') {
        // For math, group by identical tema
        const temaGroups = {};
        matchingGroups.forEach(g => {
          if (g.tema && g.tema.trim()) {
            const temaKey = g.tema.trim();
            if (!temaGroups[temaKey]) {
              temaGroups[temaKey] = [];
            }
            // Remove " 8" from the end of the name
            const cleanName = g.name.replace(/\s*8$/, '');
            temaGroups[temaKey].push(cleanName);
          }
        });

        // Add one entry per unique tema with all teacher names
        Object.keys(temaGroups).forEach(tema => {
          const teachers = temaGroups[tema].join(', ');
          const subjName = `${s.name} (${teachers})`;
          temaData.push({ subj: subjName, tag: s.tag, tema: tema });
        });
      } else {
        // For other subjects, add normally
        matchingGroups.forEach(g => {
          if (g.tema && g.tema.trim()) {
            temaData.push({ subj: s.name, tag: s.tag, tema: g.tema });
          }
        });
      }
    }
  });

  // Second page header
  h += `<div class="print-header print-header-page2">Lekser uke ${wk} ‚Äì Klasse <span class="${classColor}">${selGroup}</span> ‚Äì Lunner ungdomsskole</div>`;

  // Tema/M√•l section
  if (temaData.length) {
    h += '<div class="tema-section"><h3>üìö Tema og l√¶ringsm√•l denne uken</h3>';
    h += '<table class="tema-table">';
    temaData.forEach(t => {
      h += `<tr><td class="tema-subject ${t.tag}">${t.subj}</td><td class="tema-text">${t.tema}</td></tr>`;
    });
    h += '</table></div>';
  }

  // Homework per day
  
  DAYS.forEach((day, di) => {
    h += `<div class="day-block fade-in"><div class="day-strip">
      <span class="day-dot"></span><span class="day-lbl">${day}</span><span class="day-dt">${dates[di]}</span><div class="day-rule"></div>
    </div>`;
    const items = hwByDay[day];
    if (!items.length) {
      h += '<div class="hw-empty">Ingen lekse til denne dagen ‚ú®</div>';
    } else {
      h += '<div class="hw-cards">';
      items.forEach(it => {
        h += `<div class="hw-card">
          <div class="hw-checkbox"></div>
          <span class="hw-tag ${it.tag}">${it.subj}</span>
          <div class="hw-body"><div class="hw-body-text">${it.text}</div></div>
        </div>`;
      });
      h += '</div>';
    }
    h += '</div>';
  });

  document.getElementById('parent-view').innerHTML = h;
}

function fmtRange(s,e) {
  const mo = ['januar','februar','mars','april','mai','juni','juli','august','september','oktober','november','desember'];
  const sd=new Date(s), ed=new Date(e);
  return `${sd.getDate()}. ${mo[sd.getMonth()]} ‚Äì ${ed.getDate()}. ${mo[ed.getMonth()]}`;
}

// ‚ïê‚ïê‚ïê MODE SWITCH ‚ïê‚ïê‚ïê
let curMode = 'teacher';
function setMode(m) {
  curMode = m;
  document.querySelectorAll('.mode-btn').forEach((b,i) => b.classList.toggle('active', (m==='teacher'&&i===0)||(m==='parent'&&i===1)));
  if (m==='teacher') {
    document.getElementById('teacher-view').style.display='';
    document.getElementById('parent-view').style.display='none';
  } else {
    // Sync equip values from inputs
    subjects.forEach((s,si) => { const el=document.getElementById('eq-'+si); if(el) s.equip=el.value; });
    document.getElementById('teacher-view').style.display='none';
    document.getElementById('parent-view').style.display='';
    renderParent();
  }
}

let currentWeek = 7; // Track current week

function getISOWeekNumber(date) {
  const d = new Date(date);
  d.setHours(0, 0, 0, 0);
  d.setDate(d.getDate() + 4 - (d.getDay() || 7));
  const yearStart = new Date(d.getFullYear(), 0, 1);
  const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
  return weekNo;
}

function initializeWeek() {
  const today = new Date();
  const currentISOWeek = getISOWeekNumber(today);
  const nextWeek = currentISOWeek + 1;
  
  // Set the week number field
  document.getElementById('weekNum').value = nextWeek;
  currentWeek = nextWeek;
  
  // Update everything
  document.getElementById('topbar-title').textContent = `Ukeplan ‚Äì Uke ${nextWeek}`;
  updateCalendarWeeks();
  updateWeekDates();
}

function updTitle() {
  // Save data for the PREVIOUS week before switching
  const oldWeek = currentWeek;
  const newWeek = parseInt(document.getElementById('weekNum').value);
  
  // Save old week's data
  for (let r = 0; r < 4; r++) {
    const week = oldWeek + r;
    const row = [];
    for (let c = 0; c < 5; c++) {
      const el = document.getElementById(`c${r}${c}`);
      row.push(el ? el.value : '');
    }
    calendarData[week] = row;
  }
  
  currentWeek = newWeek;
  document.getElementById('topbar-title').textContent = `Ukeplan ‚Äì Uke ${newWeek}`; 
  updateCalendarWeeks();
  updateWeekDates();
}

function updateCalendarWeeks() {
  const baseWeek = parseInt(document.getElementById('weekNum').value);
  for (let i = 0; i < 4; i++) {
    const wkEl = document.getElementById('wk' + i);
    if (wkEl) wkEl.textContent = baseWeek + i;
  }
  loadCalendarData();
}

function saveCalendarData() {
  // Save current input values to calendarData
  const baseWeek = parseInt(document.getElementById('weekNum').value);
  for (let r = 0; r < 4; r++) {
    const week = baseWeek + r;
    const row = [];
    for (let c = 0; c < 5; c++) {
      const el = document.getElementById(`c${r}${c}`);
      row.push(el ? el.value : '');
    }
    calendarData[week] = row;
  }
}

function loadCalendarData() {
  // Load data from calendarData into input fields
  const baseWeek = parseInt(document.getElementById('weekNum').value);
  for (let r = 0; r < 4; r++) {
    const week = baseWeek + r;
    const weekData = calendarData[week] || ['', '', '', '', ''];
    for (let c = 0; c < 5; c++) {
      const el = document.getElementById(`c${r}${c}`);
      if (el) el.value = weekData[c] || '';
    }
  }
}

function updateWeekDates() {
  const weekNum = parseInt(document.getElementById('weekNum').value);
  const year = 2026; // Current year
  
  // Calculate Monday of the selected week
  const jan4 = new Date(year, 0, 4);
  const dayOfWeek = jan4.getDay() || 7; // Sunday = 7
  const mondayOfWeek1 = new Date(jan4);
  mondayOfWeek1.setDate(jan4.getDate() - dayOfWeek + 1);
  
  const monday = new Date(mondayOfWeek1);
  monday.setDate(mondayOfWeek1.getDate() + (weekNum - 1) * 7);
  
  const friday = new Date(monday);
  friday.setDate(monday.getDate() + 4);
  
  // Format as YYYY-MM-DD
  const formatDate = (d) => {
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${y}-${m}-${day}`;
  };
  
  document.getElementById('weekStart').value = formatDate(monday);
  document.getElementById('weekEnd').value = formatDate(friday);
}
function printParent() { setMode('parent'); setTimeout(()=>window.print(), 300); }
function saveData() { showToast('Utkast lagret!'); }
function showToast(msg) { const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2000); }

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
initializeWeek(); // Set week to next week automatically
renderForms();
// Auto-grow info textarea on load
setTimeout(autoGrowAll, 50);
setTimeout(loadCalendarData, 100); // Load initial calendar data after DOM is ready

// Add change listeners to calendar inputs
for (let r = 0; r < 4; r++) {
  for (let c = 0; c < 5; c++) {
    const el = document.getElementById(`c${r}${c}`);
    if (el) el.addEventListener('change', saveCalendarData);
  }
}
</script>
</body>
</html>
